<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SAMA</title>
    <style>
      /* Light theme (Anthropic-inspired brand palette) */
      :root {
        color-scheme: light;

        --ink: #141413;
        --paper: #faf9f5;
        --paper2: #f3f1e8;
        --line: #e8e6dc;
        --line2: rgba(20, 20, 19, 0.14);

        --muted: rgba(20, 20, 19, 0.64);
        --muted2: rgba(20, 20, 19, 0.48);

        --accent: #d97757; /* orange */
        --accent2: #6a9bcc; /* blue */
        --accent3: #788c5d; /* green */

        --shadow: 0 24px 70px rgba(20, 20, 19, 0.12);
        --shadow2: 0 10px 30px rgba(20, 20, 19, 0.12);

        --r-lg: 18px;
        --r-md: 14px;
        --r-sm: 12px;

        --font-display: "Poppins", "Microsoft YaHei UI", "Segoe UI", sans-serif;
        --font-body: "Lora", "Microsoft YaHei UI", "Segoe UI", Georgia, serif;
      }

      html,
      body {
        width: 100%;
        height: 100%;
        margin: 0;
        background: var(--paper);
        color: var(--ink);
        overflow: hidden;
        font: 14px/1.45 var(--font-body);
      }

      /* A soft, paper-like atmosphere (no purple bias) */
      .bg {
        position: fixed;
        inset: 0;
        pointer-events: none;
        background:
          radial-gradient(900px 520px at 12% 8%, rgba(217, 119, 87, 0.12), transparent 55%),
          radial-gradient(900px 520px at 82% 12%, rgba(106, 155, 204, 0.12), transparent 56%),
          radial-gradient(800px 520px at 76% 86%, rgba(120, 140, 93, 0.1), transparent 55%),
          linear-gradient(180deg, var(--paper), var(--paper2));
      }
      .bg::after {
        content: "";
        position: absolute;
        inset: 0;
        opacity: 0.08;
        background-image: radial-gradient(rgba(20, 20, 19, 0.7) 1px, transparent 1px);
        background-size: 18px 18px;
        mix-blend-mode: multiply;
        filter: blur(0.2px);
      }

      #app {
        height: 100%;
        display: grid;
        grid-template-rows: auto 1fr;
      }

      /* Top bar stays extremely minimal (user asked for "only a chat window") */
      .topbar {
        height: 48px;
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 8px 10px;
        box-sizing: border-box;
        background: rgba(250, 249, 245, 0.78);
        border-bottom: 1px solid rgba(20, 20, 19, 0.08);
        backdrop-filter: blur(10px);
      }
      /* In chat view the bar should feel invisible (just a floating settings icon). */
      #app[data-view="chat"] .topbar {
        background: transparent;
        border-bottom: none;
        backdrop-filter: none;
      }
      #backBtn {
        display: none;
      }
      /* Only one nav button at a time (reduces “useless buttons” clutter). */
      #app[data-view="settings"] #settingsBtn {
        display: none;
      }
      #app[data-view="settings"] #backBtn {
        display: inline-flex;
      }

      .iconBtn {
        width: 36px;
        height: 36px;
        border-radius: 12px;
        border: 1px solid rgba(20, 20, 19, 0.12);
        background: rgba(255, 255, 255, 0.65);
        box-shadow: 0 10px 24px rgba(20, 20, 19, 0.08);
        color: rgba(20, 20, 19, 0.9);
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        transition: transform 120ms ease, box-shadow 120ms ease, background 120ms ease;
      }
      .iconBtn:hover {
        transform: translateY(-1px);
        box-shadow: 0 14px 30px rgba(20, 20, 19, 0.12);
        background: rgba(255, 255, 255, 0.78);
      }
      .iconBtn:active {
        transform: translateY(0px);
      }
      .iconBtn:focus-visible {
        outline: none;
        box-shadow: 0 0 0 4px rgba(217, 119, 87, 0.22), 0 14px 30px rgba(20, 20, 19, 0.12);
        border-color: rgba(217, 119, 87, 0.55);
      }
      .iconBtn svg {
        width: 18px;
        height: 18px;
      }

      /* Views */
      .stage {
        position: relative;
        height: 100%;
        overflow: hidden;
      }

      .view {
        position: absolute;
        inset: 0;
        display: grid;
        grid-template-rows: 1fr auto;
        opacity: 0;
        transform: translateY(10px);
        pointer-events: none;
        transition: opacity 160ms ease, transform 220ms cubic-bezier(0.2, 0.85, 0.2, 1);
      }

      #app[data-view="chat"] #chatView,
      #app[data-view="settings"] #settingsView {
        opacity: 1;
        transform: translateY(0);
        pointer-events: auto;
      }

      /* Chat */
      .timeline {
        overflow: auto;
        padding: 16px 14px 20px 14px;
        box-sizing: border-box;
      }

      .empty {
        height: 100%;
        display: grid;
        place-items: center;
        color: rgba(20, 20, 19, 0.55);
        text-align: center;
        padding: 28px;
        box-sizing: border-box;
      }
      .emptyTitle {
        font: 22px/1.15 var(--font-display);
        letter-spacing: 0.2px;
        margin-bottom: 10px;
      }
      .emptyDesc {
        max-width: 520px;
        font-size: 13px;
        color: rgba(20, 20, 19, 0.54);
      }

      .msgRow {
        display: flex;
        margin: 0 0 10px 0;
      }
      .msgRow.user {
        justify-content: flex-end;
      }

      .msg {
        max-width: min(680px, 86%);
        padding: 12px 13px;
        border-radius: 16px;
        border: 1px solid rgba(20, 20, 19, 0.12);
        background: rgba(255, 255, 255, 0.74);
        box-shadow: 0 12px 28px rgba(20, 20, 19, 0.08);
        white-space: pre-wrap;
        word-break: break-word;
      }

      .msg.assistant {
        border-top-left-radius: 10px;
      }
      .msg.user {
        border-top-right-radius: 10px;
        border-color: rgba(106, 155, 204, 0.32);
        background:
          linear-gradient(180deg, rgba(106, 155, 204, 0.12), rgba(255, 255, 255, 0.76));
      }

      .msgHeader {
        display: flex;
        align-items: baseline;
        justify-content: space-between;
        gap: 10px;
        margin-bottom: 6px;
      }
      .msgWho {
        font: 12px/1 var(--font-display);
        letter-spacing: 0.2px;
        color: rgba(20, 20, 19, 0.62);
      }
      .msg.user .msgWho {
        color: rgba(20, 20, 19, 0.58);
      }
      .msgTime {
        font-size: 11px;
        color: rgba(20, 20, 19, 0.42);
        font-variant-numeric: tabular-nums;
      }
      .msgBody {
        color: rgba(20, 20, 19, 0.92);
        font-size: 14px;
      }

      .composer {
        padding: 12px;
        box-sizing: border-box;
        border-top: 1px solid rgba(20, 20, 19, 0.08);
        background: rgba(250, 249, 245, 0.72);
        backdrop-filter: blur(12px);
      }

      .composerCard {
        border-radius: var(--r-lg);
        border: 1px solid rgba(20, 20, 19, 0.14);
        background: rgba(255, 255, 255, 0.76);
        box-shadow: var(--shadow2);
        padding: 10px;
        display: grid;
        gap: 8px;
      }

      .composerRow {
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 10px;
        align-items: end;
      }

      #chatInput {
        width: 100%;
        min-height: 44px;
        max-height: 168px;
        resize: none;
        border-radius: 14px;
        border: 1px solid rgba(20, 20, 19, 0.14);
        padding: 10px 12px;
        box-sizing: border-box;
        background: rgba(255, 255, 255, 0.92);
        color: rgba(20, 20, 19, 0.92);
        outline: none;
        font: 14px/1.45 var(--font-body);
        box-shadow: inset 0 0 0 1px rgba(20, 20, 19, 0.03);
      }
      #chatInput:focus-visible {
        border-color: rgba(217, 119, 87, 0.5);
        box-shadow: 0 0 0 4px rgba(217, 119, 87, 0.18), inset 0 0 0 1px rgba(20, 20, 19, 0.03);
      }

      #sendBtn {
        height: 44px;
        padding: 0 14px;
        border-radius: 14px;
        border: 1px solid rgba(217, 119, 87, 0.42);
        background: rgba(217, 119, 87, 0.14);
        color: rgba(20, 20, 19, 0.9);
        cursor: pointer;
        font: 13px/1 var(--font-display);
        letter-spacing: 0.2px;
        transition: transform 120ms ease, background 120ms ease, border-color 120ms ease;
      }
      #sendBtn:hover {
        background: rgba(217, 119, 87, 0.18);
        border-color: rgba(217, 119, 87, 0.55);
        transform: translateY(-1px);
      }
      #sendBtn:active {
        transform: translateY(0px);
      }
      #sendBtn:focus-visible {
        outline: none;
        box-shadow: 0 0 0 4px rgba(217, 119, 87, 0.22);
      }
      #sendBtn:disabled {
        opacity: 0.55;
        cursor: not-allowed;
        transform: none;
      }

      .composerHint {
        display: flex;
        justify-content: space-between;
        gap: 10px;
        color: rgba(20, 20, 19, 0.5);
        font-size: 12px;
        user-select: none;
      }
      .kbd {
        font: 11px/1 var(--font-display);
        letter-spacing: 0.2px;
        padding: 4px 8px;
        border-radius: 999px;
        border: 1px solid rgba(20, 20, 19, 0.14);
        background: rgba(255, 255, 255, 0.6);
        color: rgba(20, 20, 19, 0.72);
        white-space: nowrap;
      }

      /* Settings */
      .settingsWrap {
        position: relative;
        overflow: hidden;
        padding: 0;
        box-sizing: border-box;
      }
      .settingsRouter {
        position: relative;
        height: 100%;
        overflow: hidden;
      }
      .settingsPage {
        position: absolute;
        inset: 0;
        overflow: auto;
        padding: 14px 14px 20px 14px;
        box-sizing: border-box;
        transition: transform 240ms cubic-bezier(0.2, 0.85, 0.2, 1), opacity 200ms ease;
        will-change: transform, opacity;
      }

      .settingsHero {
        padding: 8px 4px 14px 4px;
      }
      .settingsTitle {
        font: 22px/1.06 var(--font-display);
        letter-spacing: 0.2px;
      }
      .settingsSubtitle {
        margin-top: 8px;
        color: rgba(20, 20, 19, 0.55);
        font-size: 13px;
        line-height: 1.35;
      }

      .pageHeader {
        padding: 8px 4px 10px 4px;
      }
      .pageTitle {
        font: 20px/1.08 var(--font-display);
        letter-spacing: 0.2px;
      }
      .pageSub {
        margin-top: 8px;
        color: rgba(20, 20, 19, 0.55);
        font-size: 13px;
        line-height: 1.35;
      }

      .listGroup {
        border-radius: 18px;
        border: 1px solid rgba(20, 20, 19, 0.12);
        background: rgba(255, 255, 255, 0.74);
        box-shadow: var(--shadow2);
        overflow: hidden;
      }
      .listGroup + .listGroup {
        margin-top: 12px;
      }
      .listRow {
        width: 100%;
        border: none;
        background: transparent;
        padding: 12px 12px;
        display: flex;
        align-items: center;
        gap: 12px;
        text-align: left;
        cursor: pointer;
      }
      .listRow + .listRow {
        border-top: 1px solid rgba(20, 20, 19, 0.08);
      }
      .listRow:hover {
        background: rgba(20, 20, 19, 0.03);
      }
      .listRow:active {
        background: rgba(20, 20, 19, 0.05);
      }
      .listRow:focus-visible {
        outline: none;
        box-shadow: inset 0 0 0 2px rgba(217, 119, 87, 0.45);
      }
      .rowIcon {
        width: 30px;
        height: 30px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex: 0 0 auto;
        color: rgba(255, 255, 255, 0.95);
        font: 12px/1 var(--font-display);
        letter-spacing: 0.4px;
        box-shadow: 0 10px 18px rgba(20, 20, 19, 0.12);
      }
      .rowIcon[data-variant="llm"] {
        background: linear-gradient(135deg, rgba(106, 155, 204, 0.95), rgba(120, 140, 93, 0.95));
      }
      .rowIcon[data-variant="memory"] {
        background: linear-gradient(135deg, rgba(217, 119, 87, 0.95), rgba(106, 155, 204, 0.92));
      }
      .rowIcon[data-variant="vrma"] {
        background: linear-gradient(135deg, rgba(120, 140, 93, 0.95), rgba(217, 119, 87, 0.92));
      }
      .rowIcon[data-variant="motion"] {
        background: linear-gradient(135deg, rgba(20, 20, 19, 0.78), rgba(106, 155, 204, 0.9));
      }
      .rowIcon[data-variant="keys"] {
        background: linear-gradient(135deg, rgba(20, 20, 19, 0.72), rgba(217, 119, 87, 0.9));
      }
      .rowMain {
        min-width: 0;
        flex: 1;
        display: grid;
        gap: 4px;
      }
      .rowTitle {
        font: 14px/1.1 var(--font-display);
        letter-spacing: 0.2px;
        color: rgba(20, 20, 19, 0.92);
      }
      .rowDesc {
        font-size: 12px;
        color: rgba(20, 20, 19, 0.55);
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }
      .rowRight {
        display: inline-flex;
        align-items: center;
        gap: 10px;
        flex: 0 0 auto;
        color: rgba(20, 20, 19, 0.6);
      }
      .rowValue {
        font: 12px/1 var(--font-display);
        letter-spacing: 0.2px;
        color: rgba(20, 20, 19, 0.56);
        max-width: 140px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }
      .chev {
        font-size: 18px;
        line-height: 1;
        opacity: 0.6;
      }

      /* Router states (single-column push navigation). */
      #settingsRouter[data-route="root"] #settingsRootPage {
        transform: translateX(0%);
        opacity: 1;
        pointer-events: auto;
      }
      #settingsRouter[data-route="root"] .settingsDetailPage {
        transform: translateX(100%);
        opacity: 1;
        pointer-events: none;
      }
      #settingsRouter:not([data-route="root"]) #settingsRootPage {
        transform: translateX(-14%);
        opacity: 0;
        pointer-events: none;
      }

      #settingsRouter[data-route="llm"] #settingsLlmPage,
      #settingsRouter[data-route="memory"] #settingsMemoryPage,
      #settingsRouter[data-route="vrma"] #settingsVrmaPage,
      #settingsRouter[data-route="motion"] #settingsMotionPage,
      #settingsRouter[data-route="shortcuts"] #settingsShortcutsPage {
        transform: translateX(0%);
        opacity: 1;
        pointer-events: auto;
      }

      .card {
        border-radius: var(--r-lg);
        border: 1px solid rgba(20, 20, 19, 0.12);
        background: rgba(255, 255, 255, 0.72);
        box-shadow: var(--shadow2);
        padding: 14px;
      }
      .card + .card {
        margin-top: 12px;
      }
      .cardTitle {
        font: 14px/1.1 var(--font-display);
        letter-spacing: 0.2px;
        margin: 0;
      }
      /* Collapsible settings cards (progressive disclosure) */
      details.card > summary.cardTitle {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        cursor: pointer;
        user-select: none;
        list-style: none;
        padding: 2px 2px;
      }
      details.card > summary.cardTitle::-webkit-details-marker {
        display: none;
      }
      details.card > summary.cardTitle::after {
        content: "▾";
        font: 12px/1 var(--font-display);
        color: rgba(20, 20, 19, 0.55);
      }
      details.card[open] > summary.cardTitle {
        margin-bottom: 10px;
      }
      details.card[open] > summary.cardTitle::after {
        content: "▴";
      }

      .subDetails {
        border-radius: 14px;
        border: 1px solid rgba(20, 20, 19, 0.12);
        background: rgba(20, 20, 19, 0.03);
        overflow: hidden;
      }
      .subDetails > summary {
        list-style: none;
        cursor: pointer;
        user-select: none;
        padding: 10px 10px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        font: 13px/1.1 var(--font-display);
        color: rgba(20, 20, 19, 0.86);
      }
      .subDetails > summary::-webkit-details-marker {
        display: none;
      }
      .subDetails > summary::after {
        content: "▾";
        opacity: 0.7;
      }
      .subDetails[open] > summary::after {
        content: "▴";
      }
      .subDetailsBody {
        padding: 10px 10px 12px 10px;
        border-top: 1px solid rgba(20, 20, 19, 0.08);
        display: grid;
        gap: 10px;
      }
      .fieldGrid {
        display: grid;
        gap: 10px;
      }
      .field {
        display: grid;
        gap: 6px;
      }
      .label {
        color: rgba(20, 20, 19, 0.74);
        font: 12px/1 var(--font-display);
        letter-spacing: 0.2px;
      }
      .input,
      .select {
        height: 40px;
        border-radius: 12px;
        border: 1px solid rgba(20, 20, 19, 0.14);
        background: rgba(255, 255, 255, 0.9);
        padding: 0 10px;
        color: rgba(20, 20, 19, 0.92);
        outline: none;
        font: 13px/1 var(--font-body);
      }
      .input:focus-visible,
      .select:focus-visible {
        border-color: rgba(217, 119, 87, 0.55);
        box-shadow: 0 0 0 4px rgba(217, 119, 87, 0.18);
      }
      .help {
        color: rgba(20, 20, 19, 0.52);
        font-size: 12px;
        line-height: 1.35;
      }

      .actionsRow {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 10px;
      }

      .divider {
        height: 1px;
        background: rgba(20, 20, 19, 0.1);
        margin: 8px 0;
      }

      .inlineRow {
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 10px;
        align-items: center;
      }

      .btnSm {
        height: 34px;
        border-radius: 12px;
        padding: 0 10px;
        font-size: 12px;
      }

      .statusLine {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        margin-top: 8px;
        padding: 9px 10px;
        border-radius: 14px;
        border: 1px solid rgba(20, 20, 19, 0.12);
        background: rgba(255, 255, 255, 0.62);
        color: rgba(20, 20, 19, 0.78);
        font-size: 12px;
        font-variant-numeric: tabular-nums;
      }

      .statusLeft {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        min-width: 0;
      }
      .statusPill {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 10px;
        border-radius: 999px;
        border: 1px solid rgba(20, 20, 19, 0.12);
        background: rgba(20, 20, 19, 0.03);
        color: rgba(20, 20, 19, 0.78);
        white-space: nowrap;
      }
      .statusDot {
        width: 7px;
        height: 7px;
        border-radius: 999px;
        background: rgba(106, 155, 204, 0.7);
        box-shadow: 0 0 0 4px rgba(106, 155, 204, 0.14);
      }
      .statusText {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .rangeRow {
        display: grid;
        grid-template-columns: 90px 1fr 64px;
        gap: 10px;
        align-items: center;
      }
      .rangeLabel {
        font: 12px/1 var(--font-display);
        letter-spacing: 0.2px;
        color: rgba(20, 20, 19, 0.74);
      }
      .rangeValue {
        text-align: right;
        font-size: 12px;
        color: rgba(20, 20, 19, 0.52);
        font-variant-numeric: tabular-nums;
      }
      .range {
        width: 100%;
        accent-color: var(--accent);
      }

      .toggle {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        color: rgba(20, 20, 19, 0.74);
        font: 12px/1 var(--font-display);
        letter-spacing: 0.2px;
        user-select: none;
      }
      .toggle input {
        width: 16px;
        height: 16px;
        accent-color: var(--accent);
      }

      .library {
        display: grid;
        gap: 10px;
      }
      .libraryHeader {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
      }
      .libraryList {
        display: grid;
        gap: 8px;
      }
      .libItem {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        padding: 10px 10px;
        border-radius: 14px;
        border: 1px solid rgba(20, 20, 19, 0.12);
        background: rgba(255, 255, 255, 0.62);
      }
      .libLeft {
        display: grid;
        gap: 4px;
        min-width: 0;
      }
      .libName {
        font: 13px/1.15 var(--font-display);
        letter-spacing: 0.2px;
        color: rgba(20, 20, 19, 0.9);
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }
      .libMeta {
        font-size: 11px;
        color: rgba(20, 20, 19, 0.5);
      }
      .libActions {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        flex-wrap: wrap;
        justify-content: flex-end;
      }

      .btn {
        height: 40px;
        padding: 0 12px;
        border-radius: 12px;
        border: 1px solid rgba(20, 20, 19, 0.14);
        background: rgba(20, 20, 19, 0.04);
        color: rgba(20, 20, 19, 0.9);
        cursor: pointer;
        font: 13px/1 var(--font-display);
        letter-spacing: 0.2px;
      }
      .btn:hover {
        background: rgba(20, 20, 19, 0.06);
      }
      .btn:focus-visible {
        outline: none;
        box-shadow: 0 0 0 4px rgba(217, 119, 87, 0.18);
        border-color: rgba(217, 119, 87, 0.45);
      }
      .btnPrimary {
        border-color: rgba(217, 119, 87, 0.42);
        background: rgba(217, 119, 87, 0.14);
      }
      .btnPrimary:hover {
        background: rgba(217, 119, 87, 0.18);
        border-color: rgba(217, 119, 87, 0.55);
      }
      .btnDanger {
        border-color: rgba(20, 20, 19, 0.16);
        background: rgba(20, 20, 19, 0.04);
      }
      .btnDanger:hover {
        border-color: rgba(20, 20, 19, 0.22);
        background: rgba(20, 20, 19, 0.06);
      }

      .toast {
        position: fixed;
        left: 50%;
        bottom: 18px;
        transform: translateX(-50%) translateY(12px);
        opacity: 0;
        pointer-events: none;
        transition: opacity 160ms ease, transform 180ms cubic-bezier(0.2, 0.85, 0.2, 1);
        padding: 10px 12px;
        border-radius: 999px;
        border: 1px solid rgba(20, 20, 19, 0.14);
        background: rgba(255, 255, 255, 0.86);
        box-shadow: var(--shadow2);
        color: rgba(20, 20, 19, 0.9);
        font: 12px/1.1 var(--font-display);
        max-width: calc(100% - 28px);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .toast[data-show="1"] {
        opacity: 1;
        transform: translateX(-50%) translateY(0px);
      }

      @media (prefers-reduced-motion: reduce) {
        .iconBtn,
        #sendBtn,
        .view,
        .toast {
          transition: none !important;
        }
        .bg::after {
          display: none;
        }
      }
    </style>
  </head>
  <body>
    <div class="bg"></div>
    <div id="app" data-view="chat">
      <div class="topbar">
        <button id="settingsBtn" class="iconBtn" type="button" aria-label="Settings">
          <!-- simple gear icon (inline to avoid asset dependencies) -->
          <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path
              d="M12 15.6a3.6 3.6 0 1 0 0-7.2 3.6 3.6 0 0 0 0 7.2Z"
              stroke="currentColor"
              stroke-width="1.7"
            />
            <path
              d="M19.4 13.2c.04-.39.04-.8 0-1.2l1.53-1.19a.6.6 0 0 0 .14-.77l-1.45-2.5a.6.6 0 0 0-.73-.27l-1.8.73a7.3 7.3 0 0 0-1.03-.6l-.27-1.92A.6.6 0 0 0 14.2 3h-2.9a.6.6 0 0 0-.59.5l-.27 1.92c-.36.16-.71.36-1.03.6l-1.8-.73a.6.6 0 0 0-.73.27l-1.45 2.5a.6.6 0 0 0 .14.77L4.6 12c-.04.39-.04.8 0 1.2l-1.53 1.19a.6.6 0 0 0-.14.77l1.45 2.5c.16.27.48.38.77.27l1.8-.73c.32.24.67.44 1.03.6l.27 1.92c.05.29.3.5.59.5h2.9c.29 0 .54-.21.59-.5l.27-1.92c.36-.16.71-.36 1.03-.6l1.8.73c.29.11.61 0 .77-.27l1.45-2.5a.6.6 0 0 0-.14-.77l-1.53-1.19Z"
              stroke="currentColor"
              stroke-width="1.3"
              stroke-linejoin="round"
            />
          </svg>
        </button>

        <button id="backBtn" class="iconBtn" type="button" aria-label="Back">
          <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path
              d="M14.5 5.5L8 12l6.5 6.5"
              stroke="currentColor"
              stroke-width="1.8"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
        </button>
      </div>

      <div class="stage">
        <!-- Chat view -->
        <div id="chatView" class="view" aria-label="Chat">
          <div id="timeline" class="timeline" role="log" aria-live="polite"></div>
          <div class="composer">
            <div class="composerCard">
              <div class="composerRow">
                <textarea id="chatInput" placeholder="给 SAMA 发一条消息…" spellcheck="false"></textarea>
                <button id="sendBtn" type="button" disabled>发送</button>
              </div>
              <div class="composerHint">
                <span>Enter 发送 · Shift+Enter 换行</span>
                <span class="kbd">Ctrl+Shift+C 快速发送</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Settings view -->
        <div id="settingsView" class="view" aria-label="Settings">
          <div class="settingsWrap">
            <div id="settingsRouter" class="settingsRouter" data-route="root">
              <!-- Root (iOS-like categories) -->
              <div id="settingsRootPage" class="settingsPage settingsRootPage" aria-label="Settings Home">
                <div class="settingsHero">
                  <div class="settingsTitle">设置</div>
                  <div class="settingsSubtitle">像 iOS 设置一样：先选分类，再进入细节。</div>
                </div>

                <div class="listGroup" aria-label="Core">
                  <button class="listRow" type="button" data-settings-route="llm">
                    <div class="rowIcon" data-variant="llm" aria-hidden="true">LLM</div>
                    <div class="rowMain">
                      <div class="rowTitle">LLM</div>
                      <div class="rowDesc">Provider / Key / Base URL</div>
                    </div>
                    <div class="rowRight">
                      <div class="rowValue" id="settingsLlmSummary">—</div>
                      <div class="chev" aria-hidden="true">›</div>
                    </div>
                  </button>

                  <button class="listRow" type="button" data-settings-route="memory">
                    <div class="rowIcon" data-variant="memory" aria-hidden="true">MEM</div>
                    <div class="rowMain">
                      <div class="rowTitle">长期记忆</div>
                      <div class="rowDesc">notes / 自动记忆 / 注入</div>
                    </div>
                    <div class="rowRight">
                      <div class="rowValue" id="settingsMemorySummary">—</div>
                      <div class="chev" aria-hidden="true">›</div>
                    </div>
                  </button>
                </div>

                <div class="listGroup" aria-label="Motion">
                  <button class="listRow" type="button" data-settings-route="vrma">
                    <div class="rowIcon" data-variant="vrma" aria-hidden="true">VR</div>
                    <div class="rowMain">
                      <div class="rowTitle">动作（VRMA）</div>
                      <div class="rowDesc">上传 / 播放 / Idle / Walk / 动作库</div>
                    </div>
                    <div class="rowRight">
                      <div class="rowValue">—</div>
                      <div class="chev" aria-hidden="true">›</div>
                    </div>
                  </button>

                  <button class="listRow" type="button" data-settings-route="motion">
                    <div class="rowIcon" data-variant="motion" aria-hidden="true">FX</div>
                    <div class="rowMain">
                      <div class="rowTitle">程序动作（兜底）</div>
                      <div class="rowDesc">Idle / Walk 的强度与速度</div>
                    </div>
                    <div class="rowRight">
                      <div class="rowValue">—</div>
                      <div class="chev" aria-hidden="true">›</div>
                    </div>
                  </button>
                </div>

                <div class="listGroup" aria-label="Other">
                  <button class="listRow" type="button" data-settings-route="shortcuts">
                    <div class="rowIcon" data-variant="keys" aria-hidden="true">⌘</div>
                    <div class="rowMain">
                      <div class="rowTitle">快捷键</div>
                      <div class="rowDesc">Ctrl+Shift+C / Ctrl+Alt+O / Ctrl+Alt+P</div>
                    </div>
                    <div class="rowRight">
                      <div class="rowValue">—</div>
                      <div class="chev" aria-hidden="true">›</div>
                    </div>
                  </button>
                </div>

                <div class="help" style="margin-top: 12px; padding: 0 4px">
                  提示：左上角返回键会在「详情页 → 分类页 → 聊天页」之间智能返回。
                </div>
              </div>

              <!-- Detail pages -->
              <div id="settingsLlmPage" class="settingsPage settingsDetailPage" aria-label="LLM Settings">
                <div class="pageHeader">
                  <div class="pageTitle">LLM</div>
                  <div class="pageSub">选择 Provider，并按需展开具体配置。</div>
                </div>
                <div class="card">
                  <div class="fieldGrid">
                <div class="field">
                  <div class="label">Provider</div>
                  <select id="provider" class="select">
                    <option value="auto">auto（自动）</option>
                    <option value="off">off（禁用）</option>
                    <option value="openai">openai</option>
                    <option value="deepseek">deepseek</option>
                    <option value="aistudio">aistudio (Gemini)</option>
                  </select>
                  <div class="help" id="providerHelp">推荐 auto：有 key 就用，没有就 fallback。</div>
                  <div class="help" id="llmRuntime" style="margin-top: 6px">当前运行：—</div>
                </div>

                <details id="openaiDetails" class="subDetails">
                  <summary>OpenAI</summary>
                  <div class="subDetailsBody">
                    <div class="field">
                      <div class="label">OpenAI API Key</div>
                      <input id="openaiKey" class="input" type="password" autocomplete="off" placeholder="sk-..." />
                    </div>
                    <div class="field">
                      <div class="label">OpenAI Model</div>
                      <input id="openaiModel" class="input" type="text" autocomplete="off" placeholder="gpt-4o-mini" />
                    </div>
                    <div class="field">
                      <div class="label">OpenAI Base URL（可选）</div>
                      <input
                        id="openaiBaseUrl"
                        class="input"
                        type="text"
                        autocomplete="off"
                        placeholder="https://api.openai.com/v1"
                      />
                      <div class="help">如果你用 OpenAI-compatible 网关（本地或私有），在这里填。</div>
                    </div>
                  </div>
                </details>

                <details id="deepseekDetails" class="subDetails">
                  <summary>DeepSeek</summary>
                  <div class="subDetailsBody">
                    <div class="field">
                      <div class="label">DeepSeek API Key</div>
                      <input id="deepseekKey" class="input" type="password" autocomplete="off" placeholder="sk-..." />
                    </div>
                    <div class="field">
                      <div class="label">DeepSeek Model</div>
                      <input id="deepseekModel" class="input" type="text" autocomplete="off" placeholder="deepseek-chat" />
                    </div>
                    <div class="field">
                      <div class="label">DeepSeek Base URL（可选）</div>
                      <input
                        id="deepseekBaseUrl"
                        class="input"
                        type="text"
                        autocomplete="off"
                        placeholder="https://api.deepseek.com/v1"
                      />
                    </div>
                  </div>
                </details>

                <details id="aistudioDetails" class="subDetails">
                  <summary>AIStudio（Gemini）</summary>
                  <div class="subDetailsBody">
                    <div class="field">
                      <div class="label">AIStudio API Key</div>
                      <input id="aistudioKey" class="input" type="password" autocomplete="off" placeholder="AIza..." />
                      <div class="help">AIStudio 默认走 Gemini generateContent；如你有 OpenAI-compatible 网关，可填 Base URL。</div>
                    </div>
                    <div class="field">
                      <div class="label">AIStudio Model</div>
                      <input id="aistudioModel" class="input" type="text" autocomplete="off" placeholder="gemini-1.5-flash" />
                    </div>
                    <div class="field">
                      <div class="label">AIStudio Base URL（可选）</div>
                      <input
                        id="aistudioBaseUrl"
                        class="input"
                        type="text"
                        autocomplete="off"
                        placeholder="(留空 = Gemini 官方接口)"
                      />
                    </div>
                  </div>
                </details>
              </div>

              <div class="actionsRow">
                <button id="saveLlm" class="btn btnPrimary" type="button">保存</button>
                <button id="reloadLlm" class="btn" type="button">重新读取</button>
              </div>
                </div>
              </div>

              <div id="settingsMemoryPage" class="settingsPage settingsDetailPage" aria-label="Memory Settings">
                <div class="pageHeader">
                  <div class="pageTitle">长期记忆</div>
                  <div class="pageSub">本地 SQLite。可手动记住，也可自动从对话提取（更像 agent）。</div>
                </div>
                <div class="card">
                  <div class="fieldGrid">
                <div class="help">
                  聊天记录会保存在本机（SQLite）。你也可以手动添加“记忆”，让 SAMA 在之后的对话中参考。
                  在聊天里发送：<span class="kbd">记住: ...</span> 也可以。
                </div>

                <div id="memoryStatus" class="statusLine">
                  <div class="statusLeft">
                    <span class="statusDot" aria-hidden="true"></span>
                    <span class="statusText">状态：—</span>
                  </div>
                  <span class="statusPill" id="memoryCounts">chat - · notes -</span>
                </div>

                <label class="toggle"><input id="memoryAutoEnabled" type="checkbox" />自动记忆（从对话中提取）</label>

                <div id="memoryAutoOptions" class="fieldGrid" style="margin-top: 2px">
                  <div class="field">
                    <div class="label">自动记忆模式</div>
                    <select id="memoryAutoMode" class="select">
                      <option value="rules">规则（快速）</option>
                      <option value="llm">LLM（更像 agent，会额外请求一次）</option>
                    </select>
                    <div class="help" id="memoryAutoHelp">建议先用规则模式；想更像 agent 再切到 LLM。</div>
                  </div>
                </div>

                <div class="rangeRow">
                  <div class="rangeLabel">注入条数</div>
                  <input id="memoryInjectLimit" class="range" type="range" min="0" max="20" step="1" value="12" />
                  <div class="rangeValue" id="memoryInjectLimitValue">12</div>
                </div>

                <div class="field">
                  <div class="label">手动记住</div>
                  <div class="inlineRow">
                    <input
                      id="memoryNoteInput"
                      class="input"
                      type="text"
                      autocomplete="off"
                      placeholder="例如：我喜欢简洁回答 / 我叫… / 我的偏好是…"
                    />
                    <button id="memoryNoteAdd" class="btn btnSm btnPrimary" type="button">记住</button>
                  </div>
                  <div class="help">只写入本地，不会上传。</div>
                </div>

                <div class="library">
                  <div class="libraryHeader">
                    <div class="label">最近记忆</div>
                    <button id="refreshMemoryNotes" class="btn btnSm" type="button">刷新</button>
                  </div>
                  <div id="memoryNotesEmpty" class="help">暂无。</div>
                  <div id="memoryNotesList" class="libraryList"></div>
                </div>
              </div>

              <details class="subDetails" style="margin-top: 10px">
                <summary>清理（危险操作）</summary>
                <div class="subDetailsBody">
                  <div class="help">删除操作不可恢复。建议先确认你不需要这些内容。</div>
                  <div class="actionsRow">
                    <button id="clearChatHistory" class="btn btnDanger" type="button">清空聊天记录</button>
                    <button id="clearMemoryNotes" class="btn btnDanger" type="button">清空记忆</button>
                  </div>
                </div>
              </details>
                  </div>
                </div>
              </div>

              <div id="settingsVrmaPage" class="settingsPage settingsDetailPage" aria-label="VRMA Settings">
                <div class="pageHeader">
                  <div class="pageTitle">动作（VRMA）</div>
                  <div class="pageSub">上传后即可播放，也可以设为 Idle/Walk 槽位并自动切换。</div>
                </div>
                <div class="card">
                  <div class="fieldGrid">
                <div class="help">加载 .vrma 后可播放，并可设为 Idle/Walk 槽位自动切换；也可保存到动作库。</div>

                <div class="actionsRow">
                  <button id="pickVrma" class="btn btnPrimary" type="button">上传 VRMA…</button>
                  <button id="stopVrma" class="btn" type="button" disabled>停止动作</button>
                  <button id="setIdleFromLast" class="btn" type="button" disabled>设为 Idle</button>
                  <button id="setWalkFromLast" class="btn" type="button" disabled>设为 Walk</button>
                </div>

                <div id="vrmaStatus" class="statusLine">
                  <div class="statusLeft">
                    <span class="statusDot" aria-hidden="true"></span>
                    <span class="statusText">最近：—</span>
                  </div>
                  <span class="statusPill" id="slotStatus">idle - · walk - · act -</span>
                </div>

                <div class="rangeRow">
                  <div class="rangeLabel">速度</div>
                  <input id="vrmaSpeed" class="range" type="range" min="0" max="2" step="0.05" value="1" />
                  <div class="rangeValue" id="vrmaSpeedValue">1.00x</div>
                </div>
                <label class="toggle"><input id="vrmaPaused" type="checkbox" />暂停（所有 VRMA/动画）</label>

                <div class="divider"></div>

                <div class="field">
                  <div class="label">保存到动作库</div>
                  <div class="inlineRow">
                    <input id="vrmaSaveName" class="input" type="text" placeholder="例如：idle_v2 / wave / sit" />
                    <button id="saveVrma" class="btn btnSm" type="button" disabled>保存</button>
                  </div>
                  <div class="help">动作库保存在本机（IndexedDB）。</div>
                </div>

                <div class="library">
                  <div class="libraryHeader">
                    <div class="label">动作库</div>
                    <button id="refreshVrmaLib" class="btn btnSm" type="button">刷新</button>
                  </div>
                <div id="vrmaLibEmpty" class="help">动作库为空。</div>
                <div id="vrmaLibList" class="libraryList"></div>
                </div>
              </div>
                  </div>
                </div>
              </div>

              <div id="settingsMotionPage" class="settingsPage settingsDetailPage" aria-label="Motion Settings">
                <div class="pageHeader">
                  <div class="pageTitle">程序动作（兜底）</div>
                  <div class="pageSub">当没有 VRMA Idle/Walk 时会更明显；也可作为轻微的“呼吸感”。</div>
                </div>
                <div class="card">
                  <div class="fieldGrid">
                <div class="help">当没有 VRMA Idle/Walk 时会更明显；也可作为轻微的“呼吸感”。</div>

                <label class="toggle"><input id="idleEnabled" type="checkbox" checked />启用 Idle</label>
                <div class="rangeRow">
                  <div class="rangeLabel">Idle 强度</div>
                  <input id="idleStrength" class="range" type="range" min="0" max="1" step="0.01" value="1" />
                  <div class="rangeValue" id="idleStrengthValue">1.00</div>
                </div>
                <div class="rangeRow">
                  <div class="rangeLabel">Idle 速度</div>
                  <input id="idleSpeed" class="range" type="range" min="0.2" max="2" step="0.05" value="1" />
                  <div class="rangeValue" id="idleSpeedValue">1.00x</div>
                </div>

                <label class="toggle"><input id="walkEnabled" type="checkbox" checked />启用 Walk</label>
                <div class="rangeRow">
                  <div class="rangeLabel">Walk 速度</div>
                  <input id="walkSpeed" class="range" type="range" min="0.2" max="2" step="0.05" value="1" />
                  <div class="rangeValue" id="walkSpeedValue">1.00x</div>
                </div>
                <div class="rangeRow">
                  <div class="rangeLabel">步幅</div>
                  <input id="walkStride" class="range" type="range" min="0" max="1" step="0.01" value="0.75" />
                  <div class="rangeValue" id="walkStrideValue">0.75</div>
                </div>
                  </div>
                </div>
              </div>

              <div id="settingsShortcutsPage" class="settingsPage settingsDetailPage" aria-label="Shortcuts Settings">
                <div class="pageHeader">
                  <div class="pageTitle">快捷键</div>
                  <div class="pageSub">只保留最常用的几个，不做复杂映射，避免学习成本。</div>
                </div>

                <div class="card">
                  <div class="help">
                <div><span class="kbd">Ctrl+Shift+C</span> 快速发送（仅输入框，回复只在气泡）</div>
                <div style="margin-top: 6px"><span class="kbd">Ctrl+Alt+O</span> 打开主界面（本窗口）</div>
                <div style="margin-top: 6px"><span class="kbd">Ctrl+Alt+P</span> 切换 click-through</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="composer" style="border-top: none; background: transparent">
            <div style="height: 8px"></div>
          </div>
        </div>
      </div>
    </div>

    <div id="toast" class="toast"></div>
    <script type="module" src="./main.ts"></script>
  </body>
</html>
